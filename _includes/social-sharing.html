{% comment %}
  Social Sharing Buttons
  Displays share buttons for Twitter, LinkedIn, Threads, and Email
{% endcomment %}

{% assign post_url = page.url | prepend: site.url | prepend: site.baseurl | replace: '//', '/' %}
{% assign post_title = page.title | url_encode %}
{% assign post_description = page.excerpt | default: page.description | default: site.description | strip_html | truncatewords: 30 | url_encode %}

<div class="social-sharing">
  <span class="social-sharing-label">Share:</span>
  <div class="social-sharing-buttons">
    <a 
      href="https://twitter.com/intent/tweet?url={{ post_url }}&text={{ post_title }}{% if site.author.twitter %}&via={{ site.author.twitter | url_encode }}{% endif %}" 
      target="_blank" 
      rel="noopener noreferrer"
      class="social-share-btn social-share-twitter"
      aria-label="Share on Twitter"
      title="Share on Twitter"
    >
      <span class="social-share-icon">üê¶</span>
      <span class="social-share-text">Twitter</span>
    </a>
    
    <a 
      href="https://www.linkedin.com/sharing/share-offsite/?url={{ post_url }}" 
      target="_blank" 
      rel="noopener noreferrer"
      class="social-share-btn social-share-linkedin"
      aria-label="Share on LinkedIn"
      title="Share on LinkedIn"
    >
      <span class="social-share-icon">üíº</span>
      <span class="social-share-text">LinkedIn</span>
    </a>
    
    <a 
      href="https://www.threads.net/intent/post?text={{ post_title }}%20{{ post_url }}" 
      target="_blank" 
      rel="noopener noreferrer"
      class="social-share-btn social-share-threads"
      aria-label="Share on Threads"
      title="Share on Threads"
    >
      <span class="social-share-icon">üßµ</span>
      <span class="social-share-text">Threads</span>
    </a>
    
    <a 
      href="mailto:?subject={{ post_title }}&body={{ post_url }}" 
      class="social-share-btn social-share-email"
      aria-label="Share via Email"
      title="Share via Email"
    >
      <span class="social-share-icon">‚úâÔ∏è</span>
      <span class="social-share-text">Email</span>
    </a>
    
    <button 
      class="social-share-btn social-share-copy"
      onclick="copyToClipboard('{{ post_url }}', event)"
      aria-label="Copy link to clipboard"
      title="Copy link"
    >
      <span class="social-share-icon">üîó</span>
      <span class="social-share-text">Copy Link</span>
    </button>
  </div>
</div>

<script>
function copyToClipboard(text, event) {
  const btn = event ? event.target.closest('.social-share-copy') : null;
  
  function showFeedback() {
    if (btn) {
      const originalText = btn.querySelector('.social-share-text').textContent;
      btn.querySelector('.social-share-text').textContent = 'Copied!';
      btn.classList.add('copied');
      setTimeout(function() {
        btn.querySelector('.social-share-text').textContent = originalText;
        btn.classList.remove('copied');
      }, 2000);
    }
  }
  
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(function() {
      showFeedback();
    }).catch(function(err) {
      console.error('Failed to copy: ', err);
      fallbackCopyToClipboard(text, btn);
    });
  } else {
    fallbackCopyToClipboard(text, btn);
  }
}

function fallbackCopyToClipboard(text, btn) {
  const textArea = document.createElement("textarea");
  textArea.value = text;
  textArea.style.position = "fixed";
  textArea.style.left = "-999999px";
  textArea.style.top = "-999999px";
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  try {
    document.execCommand('copy');
    if (btn) {
      const originalText = btn.querySelector('.social-share-text').textContent;
      btn.querySelector('.social-share-text').textContent = 'Copied!';
      btn.classList.add('copied');
      setTimeout(function() {
        btn.querySelector('.social-share-text').textContent = originalText;
        btn.classList.remove('copied');
      }, 2000);
    }
  } catch (err) {
    console.error('Fallback copy failed: ', err);
  }
  document.body.removeChild(textArea);
}
</script>

