{% comment %}
  Subscription Form Component
  
  RSS-to-Email Integration with Buttondown:
  This form collects email addresses and automatically sends emails when new posts are published.
  
  Setup Instructions:
  1. Sign up at https://buttondown.email
  2. Configure RSS-to-email in Settings → Basic → RSS-to-email
  3. Add your RSS feed: {{ site.url }}/atom.xml
  4. Get your Buttondown username from Settings → API
  5. Replace YOUR_USERNAME below with your actual Buttondown username
{% endcomment %}

<div class="subscription-section">
  <div class="subscription-container">
    <h3 class="subscription-title">Subscribe to the blog</h3>
    <p class="subscription-description">Get notified when new posts are published</p>
    
    <form class="subscription-form" id="subscription-form" action="https://buttondown.com/api/emails/embed-subscribe/adesina" method="POST">
      <input 
        type="email" 
        name="email" 
        id="subscription-email" 
        class="subscription-input" 
        placeholder="Enter your email address" 
        required 
        aria-label="Email address"
      >
      <button type="submit" class="subscription-button" id="subscription-submit">
        <span class="subscription-button-text">Subscribe</span>
        <span class="subscription-button-loading" style="display: none;">Subscribing...</span>
      </button>
    </form>
    
    <div class="subscription-message" id="subscription-message" style="display: none;"></div>
  </div>
</div>

<script>
(function() {
  const form = document.getElementById('subscription-form');
  const emailInput = document.getElementById('subscription-email');
  const submitButton = document.getElementById('subscription-submit');
  const buttonText = submitButton.querySelector('.subscription-button-text');
  const buttonLoading = submitButton.querySelector('.subscription-button-loading');
  const messageDiv = document.getElementById('subscription-message');
  
  if (!form) return;
  
  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const email = emailInput.value.trim();
    if (!email) return;
    
    // Show loading state
    buttonText.style.display = 'none';
    buttonLoading.style.display = 'inline';
    submitButton.disabled = true;
    messageDiv.style.display = 'none';
    
    try {
      const formData = new FormData(form);
      const response = await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      });
      
      if (response.ok) {
        // Buttondown returns 200 on success
        showMessage('Thanks for subscribing! Check your email to confirm.', 'success');
        form.reset();
      } else {
        // Handle Buttondown error responses
        try {
          const data = await response.json();
          if (data.error) {
            showMessage(data.error, 'error');
          } else if (data.errors) {
            showMessage(data.errors.map(error => error.message || error).join(', '), 'error');
          } else {
            showMessage('Something went wrong. Please try again later.', 'error');
          }
        } catch (parseError) {
          showMessage('Something went wrong. Please try again later.', 'error');
        }
      }
    } catch (error) {
      showMessage('Network error. Please check your connection and try again.', 'error');
    } finally {
      // Reset button state
      buttonText.style.display = 'inline';
      buttonLoading.style.display = 'none';
      submitButton.disabled = false;
    }
  });
  
  function showMessage(text, type) {
    messageDiv.textContent = text;
    messageDiv.className = 'subscription-message subscription-message-' + type;
    messageDiv.style.display = 'block';
    
    // Auto-hide success messages after 5 seconds
    if (type === 'success') {
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 5000);
    }
  }
})();
</script>

