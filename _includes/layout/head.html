<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">

  <title>{%if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>
  <!-- Default favicon (matches default theme: hacker) - will be updated by script if user has different preference -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3Cfilter id='glow'%3E%3CfeGaussianBlur stdDeviation='1.5' result='coloredBlur'/%3E%3CfeMerge%3E%3CfeMergeNode in='coloredBlur'/%3E%3CfeMergeNode in='SourceGraphic'/%3E%3C/feMerge%3E%3C/filter%3E%3ClinearGradient id='dGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23b5e853'/%3E%3Cstop offset='100%25' stop-color='%23a0d640'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='%23151515' rx='10'/%3E%3Cpath d='M 26 20 L 26 80 L 46 80 C 68 80 74 80 74 50 C 74 20 68 20 46 20 Z' fill='none' stroke='url(%23dGrad)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round' filter='url(%23glow)'/%3E%3C/svg%3E" type="image/svg+xml">
  <link rel="alternate icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3Cfilter id='glow'%3E%3CfeGaussianBlur stdDeviation='1.5' result='coloredBlur'/%3E%3CfeMerge%3E%3CfeMergeNode in='coloredBlur'/%3E%3CfeMergeNode in='SourceGraphic'/%3E%3C/feMerge%3E%3C/filter%3E%3ClinearGradient id='dGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23b5e853'/%3E%3Cstop offset='100%25' stop-color='%23a0d640'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='%23151515' rx='10'/%3E%3Cpath d='M 26 20 L 26 80 L 46 80 C 68 80 74 80 74 50 C 74 20 68 20 46 20 Z' fill='none' stroke='url(%23dGrad)' stroke-width='4' stroke-linecap='round' stroke-linejoin='round' filter='url(%23glow)'/%3E%3C/svg%3E">
  
  {% include features/blog-config.html %}
  
  <!-- Hide body until theme is applied to prevent flash -->
  <style id="theme-preload-style">
    body { visibility: hidden; }
  </style>
  
  <!-- Apply theme immediately to prevent flash of unstyled content -->
  <script>
  (function() {
    'use strict';
    // Get theme from localStorage synchronously (before page renders)
    var theme = null;
    var hasStoredPreference = false;
    try {
      var storedTheme = localStorage.getItem('blog-theme');
      if (storedTheme === 'modern' || storedTheme === 'hacker') {
        theme = storedTheme;
        hasStoredPreference = true;
      }
    } catch (e) {
      // localStorage not available
    }
    
    // Check if we're on the welcome page
    var isWelcomePage = false;
    try {
      var pathname = window.location.pathname;
      isWelcomePage = pathname === '/welcome.html' || 
                      pathname === '/welcome' ||
                      pathname.endsWith('/welcome.html');
    } catch (e) {
      // Can't determine, assume not welcome page
    }
    
    // Determine which theme to apply
    var themeToApply = null;
    if (hasStoredPreference) {
      // Always apply stored preference if it exists
      themeToApply = theme;
    } else if (!isWelcomePage) {
      // For non-welcome pages, apply default theme (hacker) if no preference
      // Welcome page keeps its hardcoded theme-modern for first-time visitors
      themeToApply = 'hacker';
    }
    
    // Safety fallback: ensure body is always shown, even if theme application fails
    var safetyTimeout = setTimeout(function() {
      var preloadStyle = document.getElementById('theme-preload-style');
      if (preloadStyle) {
        preloadStyle.remove();
      }
      if (document.body) {
        document.body.style.visibility = '';
        // Still try to apply theme if we have one
        if (themeToApply) {
          document.body.classList.remove('theme-modern', 'theme-hacker');
          document.body.classList.add('theme-' + themeToApply);
        }
      }
    }, 100); // Max 100ms delay before showing content
    
    // Function to apply theme and show body
    function applyThemeAndShow() {
      var body = document.body;
      if (!body) {
        // Body not ready yet - try multiple strategies
        // Strategy 1: MutationObserver (modern browsers)
        if (document.documentElement && window.MutationObserver) {
          var observer = new MutationObserver(function() {
            var body = document.body;
            if (body) {
              observer.disconnect();
              applyThemeAndShow();
            }
          });
          observer.observe(document.documentElement, { 
            childList: true, 
            subtree: true 
          });
        }
        
        // Strategy 2: Polling with requestAnimationFrame (faster than setTimeout)
        if (typeof requestAnimationFrame !== 'undefined') {
          requestAnimationFrame(applyThemeAndShow);
        } else {
          // Strategy 3: Fallback to setTimeout
          setTimeout(applyThemeAndShow, 0);
        }
        return;
      }
      
      // Clear safety timeout since we're applying theme now
      clearTimeout(safetyTimeout);
      
      // Body exists - apply theme class immediately
      if (themeToApply) {
        body.classList.remove('theme-modern', 'theme-hacker');
        body.classList.add('theme-' + themeToApply);
      }
      
      // Remove the hiding style and show body synchronously
      var preloadStyle = document.getElementById('theme-preload-style');
      if (preloadStyle) {
        preloadStyle.remove();
      }
      
      // Ensure body is visible (remove any inline hiding)
      body.style.visibility = '';
    }
    
    // Start applying theme immediately - try right away
    applyThemeAndShow();
    
    // Also listen for DOMContentLoaded as additional fallback
    if (document.readyState === 'loading') {
      var domContentLoadedHandler = function() {
        clearTimeout(safetyTimeout);
        var preloadStyle = document.getElementById('theme-preload-style');
        if (preloadStyle) {
          preloadStyle.remove();
        }
        if (document.body) {
          document.body.style.visibility = '';
          if (themeToApply) {
            document.body.classList.remove('theme-modern', 'theme-hacker');
            document.body.classList.add('theme-' + themeToApply);
          }
        }
        // Remove listener after first call (manual once: true for compatibility)
        document.removeEventListener('DOMContentLoaded', domContentLoadedHandler);
      };
      document.addEventListener('DOMContentLoaded', domContentLoadedHandler);
    }
  })();
  </script>
  
  <!-- Set favicon immediately based on stored theme preference -->
  <script>
  (function() {
    if (window.updateFavicon) {
      window.updateFavicon();
    }
  })();
  </script>

  <link rel="stylesheet" href="{{ "/css/main.css" | prepend: site.baseurl | replace: '//', '/' }}">
  
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /> {% seo %}
  
  <!-- Explicit Open Graph and Twitter Card meta tags for social sharing -->
  {% if page.image %}
    {% assign image_path = page.image %}
  {% elsif site.image %}
    {% assign image_path = site.image %}
  {% endif %}
  
  {% if image_path %}
    {% if image_path contains 'http' %}
      {% assign image_url = image_path %}
    {% else %}
      {% assign image_url = image_path | prepend: site.url | prepend: site.baseurl %}
    {% endif %}
    <meta property="og:image" content="{{ image_url }}" />
    <meta property="og:image:secure_url" content="{{ image_url }}" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="{{ image_url }}" />
  {% endif %}
  
  <!-- Author meta tags for LinkedIn and other platforms -->
  {% if site.author %}
    {% if site.author.name %}
      <meta property="article:author" content="{{ site.author.name }}" />
      <meta name="author" content="{{ site.author.name }}" />
    {% endif %}
    {% if site.author.url %}
      <meta property="article:author:url" content="{{ site.author.url }}" />
    {% endif %}
  {% endif %}
  
  <!-- Article-specific meta tags for posts -->
  {% if page.date %}
    <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}" />
  {% endif %}
  {% if page.layout == 'post' %}
    <meta property="og:type" content="article" />
  {% endif %}
</head>