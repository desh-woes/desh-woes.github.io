<!--
  Post Enhancements Script
  
  Provides:
  - Back-to-top button (appears after 300px scroll)
  - Scroll-triggered fade-in animations for music cards
  
  Included in: post.html layout
  Dependencies: .back-to-top, .music-card, .music-text-card, .fade-in classes
-->
<script>
(function() {
  'use strict';
  
  // Configuration constants
  const SCROLL_THRESHOLD = 300; // Pixels to scroll before showing back-to-top button
  const ANIMATION_THRESHOLD = 0.1; // Intersection Observer threshold (10% visible)
  const ANIMATION_ROOT_MARGIN = '0px 0px -50px 0px'; // Trigger animation 50px before element enters viewport
  
  /**
   * Initializes back-to-top button.
   * Creates floating button that appears after scrolling 300px.
   */
  function initBackToTop() {
    let backToTopBtn = document.getElementById('back-to-top');
    
    if (!backToTopBtn) {
      backToTopBtn = document.createElement('button');
      backToTopBtn.className = 'back-to-top';
      backToTopBtn.id = 'back-to-top';
      backToTopBtn.setAttribute('aria-label', 'Back to top');
      backToTopBtn.textContent = 'â†‘';
      document.body.appendChild(backToTopBtn);
    }
    
    function toggleBackToTop() {
      if (window.pageYOffset > SCROLL_THRESHOLD) {
        backToTopBtn.classList.add('visible');
      } else {
        backToTopBtn.classList.remove('visible');
      }
    }
    
    backToTopBtn.addEventListener('click', function() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    
    window.addEventListener('scroll', toggleBackToTop);
    toggleBackToTop(); // Check initial state
  }
  
  /**
   * Initializes scroll-triggered fade-in animations for music cards.
   * Uses Intersection Observer to add .fade-in class when cards enter viewport.
   */
  function initScrollAnimations() {
    const cards = document.querySelectorAll('.music-card, .music-text-card');
    if (cards.length === 0) return;
    
    const observerOptions = {
      threshold: ANIMATION_THRESHOLD,
      rootMargin: ANIMATION_ROOT_MARGIN
    };
    
    const observer = new IntersectionObserver(function(entries) {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('fade-in');
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);
    
    cards.forEach(card => observer.observe(card));
  }
  
  function init() {
    initBackToTop();
    initScrollAnimations();
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

