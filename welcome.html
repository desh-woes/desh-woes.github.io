---
layout: null
title: Welcome
---

<!DOCTYPE html>
<html lang="en">
{% include layout/head.html %}
{% include features/blog-config.html %}
{% include features/theme-manager.html %}
{% include features/preferences.html %}
<body class="theme-modern">
  <div class="welcome-container">
    <div class="welcome-card">
      <h1 class="welcome-title">Welcome</h1>
      <p class="welcome-subtitle">Being the benevolent blogger that I am, you can choose your own theme and article order.</p>
      
      <form id="welcome-form">
        <fieldset class="preference-section">
          <legend class="preference-label">Choose your theme:</legend>
          <div class="preference-options">
            <div class="preference-option">
              <input type="radio" id="theme-modern" name="theme" value="modern" checked>
              <label for="theme-modern">Modern</label>
            </div>
            <div class="preference-option">
              <input type="radio" id="theme-hacker" name="theme" value="hacker">
              <label for="theme-hacker">Hacker</label>
            </div>
          </div>
        </fieldset>
        
        <fieldset class="preference-section">
          <legend class="preference-label">Article order:</legend>
          <div class="preference-options">
            <div class="preference-option">
              <input type="radio" id="order-chronological" name="order" value="chronological" checked>
              <label for="order-chronological">Chronological</label>
            </div>
            <div class="preference-option">
              <input type="radio" id="order-random" name="order" value="random">
              <label for="order-random">Random</label>
            </div>
          </div>
        </fieldset>
        
        <button type="submit" class="continue-button">Continue to Blog</button>
      </form>
    </div>
  </div>
  
  <script>
    (function() {
      'use strict';
      
      // Form data extraction layer
      const FormDataExtractor = {
        getSelectedTheme: function() {
          const input = document.querySelector('input[name="theme"]:checked');
          return input ? input.value : null;
        },
        
        getSelectedOrder: function() {
          const input = document.querySelector('input[name="order"]:checked');
          return input ? input.value : null;
        },
        
        validate: function() {
          const theme = this.getSelectedTheme();
          const order = this.getSelectedOrder();
          if (!theme || !order) {
            console.error('Theme or order selection not found');
            return null;
          }
          return { theme, order };
        }
      };
      
      // Storage layer - handles saving preferences
      // Uses ThemeManager and BlogPreferences modules (no duplication)
      const WelcomeStorage = {
        save: function(data) {
          if (!data) return false;
          
          try {
            if (!window.ThemeManager || !window.BlogPreferences) {
              console.error('Required modules (ThemeManager, BlogPreferences) not loaded');
              return false;
            }
            
            window.ThemeManager.setTheme(data.theme);
            window.BlogPreferences.setOrder(data.order);
            window.BlogPreferences.markPreferencesSet();
            return true;
          } catch (error) {
            console.error('Error saving preferences:', error);
            return false;
          }
        }
      };
      
      // Navigation layer
      const WelcomeNavigation = {
        redirectToHome: function() {
          window.location.href = '/';
        }
      };
      
      // UI synchronization layer
      const WelcomeUISync = {
        syncThemeRadio: function() {
          if (!window.ThemeManager) {
            setTimeout(() => this.syncThemeRadio(), 50);
            return;
          }
          
          const storedTheme = window.ThemeManager.getTheme();
          const themeInput = document.querySelector(`input[name="theme"][value="${storedTheme}"]`);
          
          if (themeInput) {
            themeInput.checked = true;
            // Ensure displayed theme matches the selected button
            // Use applyTheme to avoid saving (since we're just syncing UI)
            window.ThemeManager.applyTheme(storedTheme);
          }
        },
        
        syncOrderRadio: function() {
          if (!window.BlogPreferences) {
            setTimeout(() => this.syncOrderRadio(), 50);
            return;
          }
          
          const storedOrder = window.BlogPreferences.getOrder();
          const orderInput = document.querySelector(`input[name="order"][value="${storedOrder}"]`);
          
          if (orderInput) {
            orderInput.checked = true;
          }
        },
        
        syncAll: function() {
          this.syncThemeRadio();
          this.syncOrderRadio();
        }
      };
      
      // UI event handlers
      function setupThemePreview() {
        document.querySelectorAll('input[name="theme"]').forEach(input => {
          input.addEventListener('change', function() {
            if (window.ThemeManager) {
              window.ThemeManager.setTheme(this.value);
            }
          });
        });
      }
      
      function setupFormSubmission() {
        const form = document.getElementById('welcome-form');
        if (!form) return;
        
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const data = FormDataExtractor.validate();
          WelcomeStorage.save(data);
          WelcomeNavigation.redirectToHome();
        });
      }
      
      function initWelcomePage() {
        // Setup event handlers first
        setupThemePreview();
        setupFormSubmission();
        
        // Then sync UI with stored preferences
        // Use a small delay to ensure ThemeManager has initialized
        setTimeout(() => {
          WelcomeUISync.syncAll();
        }, 150);
      }
      
      function init() {
        setTimeout(initWelcomePage, 100);
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
  
  {% include features/theme-switcher.html %}
</body>
</html>

