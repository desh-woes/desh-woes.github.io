<script>
(function() {
  const THEME_KEY = 'blog-theme';
  const THEME_MODERN = 'modern';
  const THEME_HACKER = 'hacker';

  function getStoredTheme() {
    try {
      return localStorage.getItem(THEME_KEY) || THEME_MODERN;
    } catch (e) {
      return THEME_MODERN;
    }
  }

  function setStoredTheme(theme) {
    try {
      localStorage.setItem(THEME_KEY, theme);
    } catch (e) {
      // Ignore localStorage errors
    }
  }

  function applyTheme(theme) {
    const body = document.body;
    const themeToggle = document.getElementById('theme-toggle');
    const themeToggleMobile = document.getElementById('theme-toggle-mobile');
    
    if (theme === THEME_HACKER) {
      body.classList.add('theme-hacker');
      body.classList.remove('theme-modern');
      const title = 'Switch to modern theme';
      if (themeToggle) {
        themeToggle.setAttribute('title', title);
        themeToggle.setAttribute('aria-label', title);
      }
      if (themeToggleMobile) {
        themeToggleMobile.setAttribute('title', title);
        themeToggleMobile.setAttribute('aria-label', title);
      }
    } else {
      body.classList.add('theme-modern');
      body.classList.remove('theme-hacker');
      const title = 'Switch to hacker theme';
      if (themeToggle) {
        themeToggle.setAttribute('title', title);
        themeToggle.setAttribute('aria-label', title);
      }
      if (themeToggleMobile) {
        themeToggleMobile.setAttribute('title', title);
        themeToggleMobile.setAttribute('aria-label', title);
      }
    }
    setStoredTheme(theme);
  }

  function closeMobileMenu() {
    const menuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (menuToggle && mobileMenu) {
      menuToggle.setAttribute('aria-expanded', 'false');
      mobileMenu.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }
  }

  function toggleTheme(event) {
    const currentTheme = document.body.classList.contains('theme-hacker') 
      ? THEME_HACKER 
      : THEME_MODERN;
    const newTheme = currentTheme === THEME_HACKER ? THEME_MODERN : THEME_HACKER;
    applyTheme(newTheme);
    
    // Close mobile menu if theme was toggled from mobile button
    if (event && event.target && event.target.closest('#theme-toggle-mobile')) {
      closeMobileMenu();
    }
  }

  // Initialize theme on page load
  document.addEventListener('DOMContentLoaded', function() {
    const storedTheme = getStoredTheme();
    applyTheme(storedTheme);

    // Add click handler to theme toggle buttons (desktop and mobile)
    const themeToggle = document.getElementById('theme-toggle');
    const themeToggleMobile = document.getElementById('theme-toggle-mobile');
    
    if (themeToggle) {
      themeToggle.addEventListener('click', toggleTheme);
    }
    
    if (themeToggleMobile) {
      themeToggleMobile.addEventListener('click', toggleTheme);
    }
  });
})();
</script>

